{"ast":null,"code":"import { monitor, ONE_MINUTE, ONE_SECOND, timeStampNow } from '@datadog/browser-core';\nexport var SLEEP_CHECK_DELAY = ONE_SECOND;\nexport var SLEEP_THRESHOLD = ONE_MINUTE;\nvar sleepPeriods;\nvar lastWoke;\nexport function trackSleep() {\n  lastWoke = timeStampNow();\n  sleepPeriods = [];\n  var intervalId = setInterval(monitor(checkSleep), SLEEP_CHECK_DELAY);\n  return {\n    stop: function stop() {\n      return clearInterval(intervalId);\n    }\n  };\n}\nexport function getSleepDuration(since) {\n  if (!sleepPeriods) {\n    return 0;\n  }\n\n  checkSleep();\n  var filteredPeriods;\n\n  if (since === undefined) {\n    filteredPeriods = sleepPeriods;\n  } else {\n    filteredPeriods = sleepPeriods.filter(function (period) {\n      return period.end >= since;\n    });\n  }\n\n  return filteredPeriods.reduce(function (total, period) {\n    return total + (period.end - period.start);\n  }, 0);\n}\n\nfunction checkSleep() {\n  if (lastWoke === undefined || !sleepPeriods) {\n    return;\n  }\n\n  var now = timeStampNow();\n\n  if (now - lastWoke >= SLEEP_THRESHOLD) {\n    sleepPeriods.push({\n      start: lastWoke,\n      end: now\n    });\n  }\n\n  lastWoke = now;\n}","map":{"version":3,"mappings":"AAAA,SAASA,OAAT,EAAkBC,UAAlB,EAA8BC,UAA9B,EAAqDC,YAArD,QAAyE,uBAAzE;AAEA,OAAO,IAAMC,iBAAiB,GAAGF,UAA1B;AACP,OAAO,IAAMG,eAAe,GAAGJ,UAAxB;AAEP,IAAIK,YAAJ;AACA,IAAIC,QAAJ;AAEA,OAAM,SAAUC,UAAV,GAAoB;EACxBD,QAAQ,GAAGJ,YAAY,EAAvB;EACAG,YAAY,GAAG,EAAf;EACA,IAAMG,UAAU,GAAGC,WAAW,CAACV,OAAO,CAACW,UAAD,CAAR,EAAsBP,iBAAtB,CAA9B;EACA,OAAO;IAAEQ,IAAI,EAAE;MAAM,oBAAa,CAACH,UAAD,CAAb;IAAyB;EAAvC,CAAP;AACD;AAED,OAAM,SAAUI,gBAAV,CAA2BC,KAA3B,EAA4C;EAChD,IAAI,CAACR,YAAL,EAAmB;IACjB,OAAO,CAAP;EACD;;EACDK,UAAU;EACV,IAAII,eAAJ;;EACA,IAAID,KAAK,KAAKE,SAAd,EAAyB;IACvBD,eAAe,GAAGT,YAAlB;EACD,CAFD,MAEO;IACLS,eAAe,GAAGT,YAAY,CAACW,MAAb,CAAoB,UAACC,MAAD,EAAO;MAAK,aAAM,CAACC,GAAP,IAAcL,KAAd;IAAmB,CAAnD,CAAlB;EACD;;EACD,OAAOC,eAAe,CAACK,MAAhB,CAAuB,UAACC,KAAD,EAAQH,MAAR,EAAc;IAAK,YAAK,IAAIA,MAAM,CAACC,GAAP,GAAaD,MAAM,CAACI,KAAxB,CAAL;EAAmC,CAA7E,EAA+E,CAA/E,CAAP;AACD;;AAED,SAASX,UAAT,GAAmB;EACjB,IAAIJ,QAAQ,KAAKS,SAAb,IAA0B,CAACV,YAA/B,EAA6C;IAC3C;EACD;;EACD,IAAMiB,GAAG,GAAGpB,YAAY,EAAxB;;EACA,IAAIoB,GAAG,GAAGhB,QAAN,IAAkBF,eAAtB,EAAuC;IACrCC,YAAY,CAACkB,IAAb,CAAkB;MAAEF,KAAK,EAAEf,QAAT;MAAmBY,GAAG,EAAEI;IAAxB,CAAlB;EACD;;EACDhB,QAAQ,GAAGgB,GAAX;AACD","names":["monitor","ONE_MINUTE","ONE_SECOND","timeStampNow","SLEEP_CHECK_DELAY","SLEEP_THRESHOLD","sleepPeriods","lastWoke","trackSleep","intervalId","setInterval","checkSleep","stop","getSleepDuration","since","filteredPeriods","undefined","filter","period","end","reduce","total","start","now","push"],"sourceRoot":"","sources":["../../src/domain/trackSleep.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}