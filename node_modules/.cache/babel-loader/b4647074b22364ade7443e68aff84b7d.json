{"ast":null,"code":"export var MAX_STATS_HISTORY = 10;\nvar statsPerView;\nexport function addSegment(viewId) {\n  getOrCreateReplayStats(viewId).segments_count += 1;\n}\nexport function addRecord(viewId) {\n  getOrCreateReplayStats(viewId).records_count += 1;\n}\nexport function addWroteData(viewId, additionalRawSize) {\n  getOrCreateReplayStats(viewId).segments_total_raw_size += additionalRawSize;\n}\nexport function getReplayStats(viewId) {\n  return statsPerView === null || statsPerView === void 0 ? void 0 : statsPerView.get(viewId);\n}\nexport function resetReplayStats() {\n  statsPerView = undefined;\n}\n\nfunction getOrCreateReplayStats(viewId) {\n  if (!statsPerView) {\n    statsPerView = new Map();\n  }\n\n  var replayStats;\n\n  if (statsPerView.has(viewId)) {\n    replayStats = statsPerView.get(viewId);\n  } else {\n    replayStats = {\n      records_count: 0,\n      segments_count: 0,\n      segments_total_raw_size: 0\n    };\n    statsPerView.set(viewId, replayStats);\n\n    if (statsPerView.size > MAX_STATS_HISTORY) {\n      deleteOldestStats();\n    }\n  }\n\n  return replayStats;\n}\n\nfunction deleteOldestStats() {\n  if (!statsPerView) {\n    return;\n  }\n\n  if (statsPerView.keys) {\n    statsPerView.delete(statsPerView.keys().next().value);\n  } else {\n    // IE11 doesn't support map.keys\n    var isFirst_1 = true;\n    statsPerView.forEach(function (_value, key) {\n      if (isFirst_1) {\n        statsPerView.delete(key);\n        isFirst_1 = false;\n      }\n    });\n  }\n}","map":{"version":3,"mappings":"AAEA,OAAO,IAAMA,iBAAiB,GAAG,EAA1B;AACP,IAAIC,YAAJ;AAEA,OAAM,SAAUC,UAAV,CAAqBC,MAArB,EAAmC;EACvCC,sBAAsB,CAACD,MAAD,CAAtB,CAA+BE,cAA/B,IAAiD,CAAjD;AACD;AAED,OAAM,SAAUC,SAAV,CAAoBH,MAApB,EAAkC;EACtCC,sBAAsB,CAACD,MAAD,CAAtB,CAA+BI,aAA/B,IAAgD,CAAhD;AACD;AAED,OAAM,SAAUC,YAAV,CAAuBL,MAAvB,EAAuCM,iBAAvC,EAAgE;EACpEL,sBAAsB,CAACD,MAAD,CAAtB,CAA+BO,uBAA/B,IAA0DD,iBAA1D;AACD;AAED,OAAM,SAAUE,cAAV,CAAyBR,MAAzB,EAAuC;EAC3C,OAAOF,YAAY,SAAZ,gBAAY,WAAZ,GAAY,MAAZ,eAAY,CAAEW,GAAd,CAAkBT,MAAlB,CAAP;AACD;AAED,OAAM,SAAUU,gBAAV,GAA0B;EAC9BZ,YAAY,GAAGa,SAAf;AACD;;AAED,SAASV,sBAAT,CAAgCD,MAAhC,EAA8C;EAC5C,IAAI,CAACF,YAAL,EAAmB;IACjBA,YAAY,GAAG,IAAIc,GAAJ,EAAf;EACD;;EAED,IAAIC,WAAJ;;EACA,IAAIf,YAAY,CAACgB,GAAb,CAAiBd,MAAjB,CAAJ,EAA8B;IAC5Ba,WAAW,GAAGf,YAAY,CAACW,GAAb,CAAiBT,MAAjB,CAAd;EACD,CAFD,MAEO;IACLa,WAAW,GAAG;MACZT,aAAa,EAAE,CADH;MAEZF,cAAc,EAAE,CAFJ;MAGZK,uBAAuB,EAAE;IAHb,CAAd;IAKAT,YAAY,CAACiB,GAAb,CAAiBf,MAAjB,EAAyBa,WAAzB;;IACA,IAAIf,YAAY,CAACkB,IAAb,GAAoBnB,iBAAxB,EAA2C;MACzCoB,iBAAiB;IAClB;EACF;;EAED,OAAOJ,WAAP;AACD;;AAED,SAASI,iBAAT,GAA0B;EACxB,IAAI,CAACnB,YAAL,EAAmB;IACjB;EACD;;EACD,IAAIA,YAAY,CAACoB,IAAjB,EAAuB;IACrBpB,YAAY,CAACqB,MAAb,CAAoBrB,YAAY,CAACoB,IAAb,GAAoBE,IAApB,GAA2BC,KAA/C;EACD,CAFD,MAEO;IACL;IACA,IAAIC,SAAO,GAAG,IAAd;IACAxB,YAAY,CAACyB,OAAb,CAAqB,UAACC,MAAD,EAASC,GAAT,EAAY;MAC/B,IAAIH,SAAJ,EAAa;QACXxB,YAAa,CAACqB,MAAd,CAAqBM,GAArB;QACAH,SAAO,GAAG,KAAV;MACD;IACF,CALD;EAMD;AACF","names":["MAX_STATS_HISTORY","statsPerView","addSegment","viewId","getOrCreateReplayStats","segments_count","addRecord","records_count","addWroteData","additionalRawSize","segments_total_raw_size","getReplayStats","get","resetReplayStats","undefined","Map","replayStats","has","set","size","deleteOldestStats","keys","delete","next","value","isFirst_1","forEach","_value","key"],"sourceRoot":"","sources":["../../src/domain/replayStats.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}