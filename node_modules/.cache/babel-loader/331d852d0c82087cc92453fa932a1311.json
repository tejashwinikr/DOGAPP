{"ast":null,"code":"import { addEventListener, elapsed, generateUUID, clocksNow } from '@datadog/browser-core';\nimport { ActionType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackEventCounts } from '../../trackEventCounts';\nimport { waitIdlePageActivity } from '../../trackPageActivities';\nimport { getActionNameFromElement } from './getActionNameFromElement';\nexport function trackActions(lifeCycle, domMutationObservable, configuration) {\n  var action = startActionManagement(lifeCycle, domMutationObservable, configuration); // New views trigger the discard of the current pending Action\n\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_CREATED, function () {\n    action.discardCurrent();\n  });\n  var stopListener = addEventListener(window, \"click\"\n  /* CLICK */\n  , function (event) {\n    if (!(event.target instanceof Element)) {\n      return;\n    }\n\n    var name = getActionNameFromElement(event.target, configuration.actionNameAttribute);\n\n    if (!name) {\n      return;\n    }\n\n    action.create(ActionType.CLICK, name, event);\n  }, {\n    capture: true\n  }).stop;\n  return {\n    stop: function stop() {\n      action.discardCurrent();\n      stopListener();\n    }\n  };\n}\n\nfunction startActionManagement(lifeCycle, domMutationObservable, configuration) {\n  var currentAction;\n  var currentIdlePageActivitySubscription;\n  return {\n    create: function create(type, name, event) {\n      if (currentAction) {\n        // Ignore any new action if another one is already occurring.\n        return;\n      }\n\n      var pendingAutoAction = new PendingAutoAction(lifeCycle, type, name, event);\n      currentAction = pendingAutoAction;\n      currentIdlePageActivitySubscription = waitIdlePageActivity(lifeCycle, domMutationObservable, configuration, function (params) {\n        if (params.hadActivity) {\n          pendingAutoAction.complete(params.endTime);\n        } else {\n          pendingAutoAction.discard();\n        }\n\n        currentAction = undefined;\n      });\n    },\n    discardCurrent: function discardCurrent() {\n      if (currentAction) {\n        currentIdlePageActivitySubscription.stop();\n        currentAction.discard();\n        currentAction = undefined;\n      }\n    }\n  };\n}\n\nvar PendingAutoAction =\n/** @class */\nfunction () {\n  function PendingAutoAction(lifeCycle, type, name, event) {\n    this.lifeCycle = lifeCycle;\n    this.type = type;\n    this.name = name;\n    this.event = event;\n    this.id = generateUUID();\n    this.startClocks = clocksNow();\n    this.eventCountsSubscription = trackEventCounts(lifeCycle);\n    this.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_CREATED, {\n      id: this.id,\n      startClocks: this.startClocks\n    });\n  }\n\n  PendingAutoAction.prototype.complete = function (endTime) {\n    var eventCounts = this.eventCountsSubscription.eventCounts;\n    this.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_COMPLETED, {\n      counts: {\n        errorCount: eventCounts.errorCount,\n        longTaskCount: eventCounts.longTaskCount,\n        resourceCount: eventCounts.resourceCount\n      },\n      duration: elapsed(this.startClocks.timeStamp, endTime),\n      id: this.id,\n      name: this.name,\n      startClocks: this.startClocks,\n      type: this.type,\n      event: this.event\n    });\n    this.eventCountsSubscription.stop();\n  };\n\n  PendingAutoAction.prototype.discard = function () {\n    this.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_DISCARDED);\n    this.eventCountsSubscription.stop();\n  };\n\n  return PendingAutoAction;\n}();","map":{"version":3,"mappings":"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","names":["addEventListener","elapsed","generateUUID","clocksNow","ActionType","LifeCycleEventType","trackEventCounts","waitIdlePageActivity","getActionNameFromElement","trackActions","lifeCycle","domMutationObservable","configuration","action","startActionManagement","subscribe","VIEW_CREATED","discardCurrent","stopListener","window","event","target","Element","name","actionNameAttribute","create","CLICK","capture","stop","currentAction","currentIdlePageActivitySubscription","type","pendingAutoAction","PendingAutoAction","params","hadActivity","complete","endTime","discard","undefined","id","startClocks","eventCountsSubscription","notify","AUTO_ACTION_CREATED","eventCounts","AUTO_ACTION_COMPLETED","counts","errorCount","longTaskCount","resourceCount","duration","timeStamp","AUTO_ACTION_DISCARDED"],"sourceRoot":"","sources":["../../../../src/domain/rumEventsCollection/action/trackActions.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}