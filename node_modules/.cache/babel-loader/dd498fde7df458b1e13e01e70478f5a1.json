{"ast":null,"code":"import { getCookie } from '../browser/cookie';\nimport { persistSession } from './sessionManagement';\nexport var OLD_SESSION_COOKIE_NAME = '_dd';\nexport var OLD_RUM_COOKIE_NAME = '_dd_r';\nexport var OLD_LOGS_COOKIE_NAME = '_dd_l'; // duplicate values to avoid dependency issues\n\nexport var RUM_SESSION_KEY = 'rum';\nexport var LOGS_SESSION_KEY = 'logs';\n/**\n * This migration should remain in the codebase as long as older versions are available/live\n * to allow older sdk versions to be upgraded to newer versions without compatibility issues.\n */\n\nexport function tryOldCookiesMigration(sessionCookie) {\n  var sessionString = sessionCookie.get();\n  var oldSessionId = getCookie(OLD_SESSION_COOKIE_NAME);\n  var oldRumType = getCookie(OLD_RUM_COOKIE_NAME);\n  var oldLogsType = getCookie(OLD_LOGS_COOKIE_NAME);\n\n  if (!sessionString) {\n    var session = {};\n\n    if (oldSessionId) {\n      session.id = oldSessionId;\n    }\n\n    if (oldLogsType && /^[01]$/.test(oldLogsType)) {\n      session[LOGS_SESSION_KEY] = oldLogsType;\n    }\n\n    if (oldRumType && /^[012]$/.test(oldRumType)) {\n      session[RUM_SESSION_KEY] = oldRumType;\n    }\n\n    persistSession(session, sessionCookie);\n  }\n}","map":{"version":3,"mappings":"AAAA,SAAsBA,SAAtB,QAAuC,mBAAvC;AACA,SAASC,cAAT,QAA6C,qBAA7C;AAEA,OAAO,IAAMC,uBAAuB,GAAG,KAAhC;AACP,OAAO,IAAMC,mBAAmB,GAAG,OAA5B;AACP,OAAO,IAAMC,oBAAoB,GAAG,OAA7B,C,CAEP;;AACA,OAAO,IAAMC,eAAe,GAAG,KAAxB;AACP,OAAO,IAAMC,gBAAgB,GAAG,MAAzB;AAEP;;;;;AAIA,OAAM,SAAUC,sBAAV,CAAiCC,aAAjC,EAA2D;EAC/D,IAAMC,aAAa,GAAGD,aAAa,CAACE,GAAd,EAAtB;EACA,IAAMC,YAAY,GAAGX,SAAS,CAACE,uBAAD,CAA9B;EACA,IAAMU,UAAU,GAAGZ,SAAS,CAACG,mBAAD,CAA5B;EACA,IAAMU,WAAW,GAAGb,SAAS,CAACI,oBAAD,CAA7B;;EACA,IAAI,CAACK,aAAL,EAAoB;IAClB,IAAMK,OAAO,GAAiB,EAA9B;;IACA,IAAIH,YAAJ,EAAkB;MAChBG,OAAO,CAACC,EAAR,GAAaJ,YAAb;IACD;;IACD,IAAIE,WAAW,IAAI,SAASG,IAAT,CAAcH,WAAd,CAAnB,EAA+C;MAC7CC,OAAO,CAACR,gBAAD,CAAP,GAA4BO,WAA5B;IACD;;IACD,IAAID,UAAU,IAAI,UAAUI,IAAV,CAAeJ,UAAf,CAAlB,EAA8C;MAC5CE,OAAO,CAACT,eAAD,CAAP,GAA2BO,UAA3B;IACD;;IACDX,cAAc,CAACa,OAAD,EAAUN,aAAV,CAAd;EACD;AACF","names":["getCookie","persistSession","OLD_SESSION_COOKIE_NAME","OLD_RUM_COOKIE_NAME","OLD_LOGS_COOKIE_NAME","RUM_SESSION_KEY","LOGS_SESSION_KEY","tryOldCookiesMigration","sessionCookie","sessionString","get","oldSessionId","oldRumType","oldLogsType","session","id","test"],"sourceRoot":"","sources":["../../src/domain/oldCookiesMigration.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}