{"ast":null,"code":"import { combine } from '@datadog/browser-core';\nimport { createDOMMutationObservable } from '../browser/domMutationObservable';\nimport { startPerformanceCollection } from '../browser/performanceCollection';\nimport { startRumAssembly } from '../domain/assembly';\nimport { startForegroundContexts } from '../domain/foregroundContexts';\nimport { startInternalContext } from '../domain/internalContext';\nimport { LifeCycle } from '../domain/lifeCycle';\nimport { startParentContexts } from '../domain/parentContexts';\nimport { startRequestCollection } from '../domain/requestCollection';\nimport { startActionCollection } from '../domain/rumEventsCollection/action/actionCollection';\nimport { startErrorCollection } from '../domain/rumEventsCollection/error/errorCollection';\nimport { startLongTaskCollection } from '../domain/rumEventsCollection/longTask/longTaskCollection';\nimport { startResourceCollection } from '../domain/rumEventsCollection/resource/resourceCollection';\nimport { startViewCollection } from '../domain/rumEventsCollection/view/viewCollection';\nimport { startRumSession } from '../domain/rumSession';\nimport { trackSleep } from '../domain/trackSleep';\nimport { startRumBatch } from '../transport/batch';\nexport function startRum(initConfiguration, configuration, internalMonitoring, getCommonContext, recorderApi, initialViewName) {\n  var lifeCycle = new LifeCycle();\n  var session = startRumSession(configuration, lifeCycle);\n  var domMutationObservable = createDOMMutationObservable();\n  internalMonitoring.setExternalContextProvider(function () {\n    return combine({\n      application_id: initConfiguration.applicationId\n    }, parentContexts.findView(), getCommonContext().context);\n  });\n\n  var _a = startRumEventCollection(initConfiguration.applicationId, lifeCycle, configuration, session, getCommonContext),\n      parentContexts = _a.parentContexts,\n      foregroundContexts = _a.foregroundContexts;\n\n  if (configuration.isEnabled('track-sleep')) {\n    trackSleep();\n  }\n\n  if (session.hasReplayPlan()) {\n    startLongTaskCollection(lifeCycle);\n  }\n\n  startResourceCollection(lifeCycle);\n\n  var _b = startViewCollection(lifeCycle, configuration, location, domMutationObservable, foregroundContexts, recorderApi, initialViewName),\n      addTiming = _b.addTiming,\n      startView = _b.startView;\n\n  var addError = startErrorCollection(lifeCycle, foregroundContexts).addError;\n  var addAction = startActionCollection(lifeCycle, domMutationObservable, configuration, foregroundContexts).addAction;\n  startRequestCollection(lifeCycle, configuration);\n  startPerformanceCollection(lifeCycle, configuration);\n  var internalContext = startInternalContext(initConfiguration.applicationId, session, parentContexts);\n  return {\n    addAction: addAction,\n    addError: addError,\n    addTiming: addTiming,\n    startView: startView,\n    lifeCycle: lifeCycle,\n    parentContexts: parentContexts,\n    session: session,\n    getInternalContext: internalContext.get\n  };\n}\nexport function startRumEventCollection(applicationId, lifeCycle, configuration, session, getCommonContext) {\n  var parentContexts = startParentContexts(lifeCycle, session);\n  var foregroundContexts = startForegroundContexts(configuration);\n  var batch = startRumBatch(configuration, lifeCycle);\n  startRumAssembly(applicationId, configuration, lifeCycle, session, parentContexts, getCommonContext);\n  return {\n    parentContexts: parentContexts,\n    foregroundContexts: foregroundContexts,\n    stop: function stop() {\n      // prevent batch from previous tests to keep running and send unwanted requests\n      // could be replaced by stopping all the component when they will all have a stop method\n      batch.stop();\n      parentContexts.stop();\n      foregroundContexts.stop();\n    }\n  };\n}","map":{"version":3,"mappings":"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","names":["combine","createDOMMutationObservable","startPerformanceCollection","startRumAssembly","startForegroundContexts","startInternalContext","LifeCycle","startParentContexts","startRequestCollection","startActionCollection","startErrorCollection","startLongTaskCollection","startResourceCollection","startViewCollection","startRumSession","trackSleep","startRumBatch","startRum","initConfiguration","configuration","internalMonitoring","getCommonContext","recorderApi","initialViewName","lifeCycle","session","domMutationObservable","setExternalContextProvider","application_id","applicationId","parentContexts","findView","context","startRumEventCollection","foregroundContexts","isEnabled","hasReplayPlan","location","addTiming","startView","addError","addAction","internalContext","getInternalContext","get","batch","stop"],"sourceRoot":"","sources":["../../src/boot/startRum.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}