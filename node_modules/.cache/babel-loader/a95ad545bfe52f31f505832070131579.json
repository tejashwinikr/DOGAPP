{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { LifeCycleEventType } from '@datadog/browser-rum-core';\nimport { record } from '../domain/record';\nimport { startSegmentCollection } from '../domain/segmentCollection';\nimport { send } from '../transport/send';\nimport { RecordType } from '../types';\nexport function startRecording(lifeCycle, applicationId, configuration, session, parentContexts) {\n  var _a = startSegmentCollection(lifeCycle, applicationId, session, parentContexts, function (data, meta, rawSegmentSize) {\n    return send(configuration.sessionReplayEndpoint, data, meta, rawSegmentSize);\n  }),\n      addRecord = _a.addRecord,\n      stopSegmentCollection = _a.stop;\n\n  function addRawRecord(rawRecord) {\n    addRecord(__assign(__assign({}, rawRecord), {\n      timestamp: Date.now()\n    }));\n  }\n\n  var _b = record({\n    emit: addRawRecord,\n    initialPrivacyLevel: configuration.initialPrivacyLevel\n  }),\n      stopRecording = _b.stop,\n      takeFullSnapshot = _b.takeFullSnapshot,\n      flushMutations = _b.flushMutations;\n\n  var unsubscribeViewEnded = lifeCycle.subscribe(LifeCycleEventType.VIEW_ENDED, function () {\n    flushMutations();\n    addRawRecord({\n      type: RecordType.ViewEnd\n    });\n  }).unsubscribe;\n  var unsubscribeViewCreated = lifeCycle.subscribe(LifeCycleEventType.VIEW_CREATED, takeFullSnapshot).unsubscribe;\n  return {\n    stop: function stop() {\n      unsubscribeViewEnded();\n      unsubscribeViewCreated();\n      stopRecording();\n      stopSegmentCollection();\n    }\n  };\n}","map":{"version":3,"mappings":";AACA,SAAoBA,kBAApB,QAA0E,2BAA1E;AAEA,SAASC,MAAT,QAAuB,kBAAvB;AACA,SAASC,sBAAT,QAAuC,6BAAvC;AACA,SAASC,IAAT,QAAqB,mBAArB;AACA,SAAoBC,UAApB,QAAsC,UAAtC;AAEA,OAAM,SAAUC,cAAV,CACJC,SADI,EAEJC,aAFI,EAGJC,aAHI,EAIJC,OAJI,EAKJC,cALI,EAK0B;EAExB,SAA6CR,sBAAsB,CACvEI,SADuE,EAEvEC,aAFuE,EAGvEE,OAHuE,EAIvEC,cAJuE,EAKvE,UAACC,IAAD,EAAOC,IAAP,EAAaC,cAAb,EAA2B;IAAK,WAAI,CAACL,aAAa,CAACM,qBAAf,EAAsCH,IAAtC,EAA4CC,IAA5C,EAAkDC,cAAlD,CAAJ;EAAqE,CAL9B,CAAnE;EAAA,IAAEE,SAAS,eAAX;EAAA,IAAmBC,qBAAqB,UAAxC;;EAQN,SAASC,YAAT,CAAsBC,SAAtB,EAA0C;IACxCH,SAAS,uBAAMG,SAAN,GAAe;MAAEC,SAAS,EAAEC,IAAI,CAACC,GAAL;IAAb,CAAf,EAAT;EACD;;EAEK,SAA4DpB,MAAM,CAAC;IACvEqB,IAAI,EAAEL,YADiE;IAEvEM,mBAAmB,EAAEf,aAAa,CAACe;EAFoC,CAAD,CAAlE;EAAA,IAAQC,aAAa,UAArB;EAAA,IAAuBC,gBAAgB,sBAAvC;EAAA,IAAyCC,cAAc,oBAAvD;;EAKE,IAAaC,oBAAoB,GAAKrB,SAAS,CAACsB,SAAV,CAAoB5B,kBAAkB,CAAC6B,UAAvC,EAAmD;IAC/FH,cAAc;IACdT,YAAY,CAAC;MACXa,IAAI,EAAE1B,UAAU,CAAC2B;IADN,CAAD,CAAZ;EAGD,CAL6C,EAK5CC,WALM;EAMA,IAAaC,sBAAsB,GAAK3B,SAAS,CAACsB,SAAV,CAAoB5B,kBAAkB,CAACkC,YAAvC,EAAqDT,gBAArD,EAAsEO,WAA9G;EAER,OAAO;IACLG,IAAI,EAAE;MACJR,oBAAoB;MACpBM,sBAAsB;MACtBT,aAAa;MACbR,qBAAqB;IACtB;EANI,CAAP;AAQD","names":["LifeCycleEventType","record","startSegmentCollection","send","RecordType","startRecording","lifeCycle","applicationId","configuration","session","parentContexts","data","meta","rawSegmentSize","sessionReplayEndpoint","addRecord","stopSegmentCollection","addRawRecord","rawRecord","timestamp","Date","now","emit","initialPrivacyLevel","stopRecording","takeFullSnapshot","flushMutations","unsubscribeViewEnded","subscribe","VIEW_ENDED","type","ViewEnd","unsubscribe","unsubscribeViewCreated","VIEW_CREATED","stop"],"sourceRoot":"","sources":["../../src/boot/startRecording.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}