{"ast":null,"code":"import { includes } from '../../tools/utils';\nexport var ENDPOINTS = {\n  alternate: {\n    logs: 'logs',\n    rum: 'rum',\n    sessionReplay: 'session-replay'\n  },\n  classic: {\n    logs: 'browser',\n    rum: 'rum',\n    // session-replay has no classic endpoint\n    sessionReplay: undefined\n  }\n};\nvar INTAKE_TRACKS = {\n  logs: 'logs',\n  rum: 'rum',\n  sessionReplay: 'replay'\n};\nexport var ENDPOINTS_TYPES = Object.keys(ENDPOINTS['alternate']);\nexport var INTAKE_SITE_US = 'datadoghq.com';\nvar INTAKE_SITE_US3 = 'us3.datadoghq.com';\nvar INTAKE_SITE_GOV = 'ddog-gov.com';\nvar INTAKE_SITE_EU = 'datadoghq.eu';\nvar CLASSIC_ALLOWED_SITES = [INTAKE_SITE_US, INTAKE_SITE_EU];\nvar INTAKE_V1_ALLOWED_SITES = [INTAKE_SITE_US, INTAKE_SITE_US3, INTAKE_SITE_EU, INTAKE_SITE_GOV];\nexport function createEndpointBuilder(initConfiguration, buildEnv, isIntakeV2Enabled) {\n  var sdkVersion = buildEnv.sdkVersion;\n  var _a = initConfiguration.site,\n      site = _a === void 0 ? INTAKE_SITE_US : _a,\n      clientToken = initConfiguration.clientToken,\n      env = initConfiguration.env,\n      proxyHost = initConfiguration.proxyHost,\n      proxyUrl = initConfiguration.proxyUrl,\n      service = initConfiguration.service,\n      version = initConfiguration.version,\n      intakeApiVersion = initConfiguration.intakeApiVersion,\n      useAlternateIntakeDomains = initConfiguration.useAlternateIntakeDomains;\n\n  function build(endpointType, source) {\n    var host = buildHost(endpointType);\n    var path = buildPath(endpointType);\n    var queryParameters = buildQueryParameters(endpointType, source);\n    var endpoint = \"https://\" + host + path + \"?\" + queryParameters;\n\n    if (proxyUrl) {\n      return proxyUrl + \"?ddforward=\" + encodeURIComponent(endpoint);\n    } else if (proxyHost) {\n      return \"https://\" + proxyHost + path + \"?ddhost=\" + host + \"&\" + queryParameters;\n    }\n\n    return endpoint;\n  }\n\n  function buildIntakeUrl(endpointType) {\n    var endpoint = build(endpointType);\n    return endpoint.slice(0, endpoint.indexOf('?'));\n  }\n\n  function buildHost(endpointType) {\n    if (shouldUseAlternateDomain(endpointType)) {\n      var endpoint_1 = ENDPOINTS.alternate[endpointType];\n      var domainParts = site.split('.');\n      var extension = domainParts.pop();\n      var suffix = domainParts.join('-') + \".\" + extension;\n      return endpoint_1 + \".browser-intake-\" + suffix;\n    }\n\n    var endpoint = ENDPOINTS.classic[endpointType];\n    return endpoint + \"-http-intake.logs.\" + site;\n  }\n\n  function buildPath(endpointType) {\n    return shouldUseIntakeV2(endpointType) ? \"/api/v2/\" + INTAKE_TRACKS[endpointType] : \"/v1/input/\" + clientToken;\n  }\n\n  function buildQueryParameters(endpointType, source) {\n    var tags = \"sdk_version:\" + sdkVersion + (\"\" + (env ? \",env:\" + env : '')) + (\"\" + (service ? \",service:\" + service : '')) + (\"\" + (version ? \",version:\" + version : ''));\n    var parameters = \"ddsource=\" + (source || 'browser') + \"&ddtags=\" + encodeURIComponent(tags);\n\n    if (shouldUseIntakeV2(endpointType)) {\n      parameters += \"&dd-api-key=\" + clientToken + \"&\" + (\"dd-evp-origin-version=\" + encodeURIComponent(sdkVersion) + \"&\") + \"dd-evp-origin=browser\";\n    }\n\n    return parameters;\n  }\n\n  function shouldUseIntakeV2(endpointType) {\n    return !!isIntakeV2Enabled && (intakeApiVersion === 2 || !includes(INTAKE_V1_ALLOWED_SITES, site) || endpointType === 'sessionReplay');\n  }\n\n  function shouldUseAlternateDomain(endpointType) {\n    return useAlternateIntakeDomains || !includes(CLASSIC_ALLOWED_SITES, site) || endpointType === 'sessionReplay';\n  }\n\n  return {\n    build: build,\n    buildIntakeUrl: buildIntakeUrl\n  };\n}","map":{"version":3,"mappings":"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","names":["includes","ENDPOINTS","alternate","logs","rum","sessionReplay","classic","undefined","INTAKE_TRACKS","ENDPOINTS_TYPES","Object","keys","INTAKE_SITE_US","INTAKE_SITE_US3","INTAKE_SITE_GOV","INTAKE_SITE_EU","CLASSIC_ALLOWED_SITES","INTAKE_V1_ALLOWED_SITES","createEndpointBuilder","initConfiguration","buildEnv","isIntakeV2Enabled","sdkVersion","_a","clientToken","env","proxyHost","proxyUrl","service","version","intakeApiVersion","useAlternateIntakeDomains","build","endpointType","source","host","buildHost","path","buildPath","queryParameters","buildQueryParameters","endpoint","encodeURIComponent","buildIntakeUrl","slice","indexOf","shouldUseAlternateDomain","endpoint_1","domainParts","site","split","extension","pop","suffix","join","shouldUseIntakeV2","tags","parameters"],"sourceRoot":"","sources":["../../../src/domain/configuration/endpointBuilder.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}