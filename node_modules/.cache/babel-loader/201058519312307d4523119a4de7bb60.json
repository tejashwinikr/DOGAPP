{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { RecordType } from '../../types';\nimport { serializeDocument } from './serialize';\nimport { initObservers } from './observer';\nimport { IncrementalSource } from './types';\nimport { getWindowHeight, getWindowWidth } from './utils';\nimport { MutationController } from './mutationObserver';\nexport function record(options) {\n  var emit = options.emit; // runtime checks for user options\n\n  if (!emit) {\n    throw new Error('emit function is required');\n  }\n\n  var mutationController = new MutationController();\n\n  var takeFullSnapshot = function takeFullSnapshot() {\n    var _a, _b, _c, _d;\n\n    mutationController.flush(); // process any pending mutation before taking a full snapshot\n\n    emit({\n      data: {\n        height: getWindowHeight(),\n        href: window.location.href,\n        width: getWindowWidth()\n      },\n      type: RecordType.Meta\n    });\n    emit({\n      data: {\n        has_focus: document.hasFocus()\n      },\n      type: RecordType.Focus\n    });\n    emit({\n      data: {\n        node: serializeDocument(document, options.initialPrivacyLevel),\n        initialOffset: {\n          left: window.pageXOffset !== undefined ? window.pageXOffset : (document === null || document === void 0 ? void 0 : document.documentElement.scrollLeft) || ((_b = (_a = document === null || document === void 0 ? void 0 : document.body) === null || _a === void 0 ? void 0 : _a.parentElement) === null || _b === void 0 ? void 0 : _b.scrollLeft) || (document === null || document === void 0 ? void 0 : document.body.scrollLeft) || 0,\n          top: window.pageYOffset !== undefined ? window.pageYOffset : (document === null || document === void 0 ? void 0 : document.documentElement.scrollTop) || ((_d = (_c = document === null || document === void 0 ? void 0 : document.body) === null || _c === void 0 ? void 0 : _c.parentElement) === null || _d === void 0 ? void 0 : _d.scrollTop) || (document === null || document === void 0 ? void 0 : document.body.scrollTop) || 0\n        }\n      },\n      type: RecordType.FullSnapshot\n    });\n  };\n\n  takeFullSnapshot();\n  var stopObservers = initObservers({\n    mutationController: mutationController,\n    initialPrivacyLevel: options.initialPrivacyLevel,\n    inputCb: function inputCb(v) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.Input\n        }, v),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mediaInteractionCb: function mediaInteractionCb(p) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.MediaInteraction\n        }, p),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mouseInteractionCb: function mouseInteractionCb(d) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.MouseInteraction\n        }, d),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mousemoveCb: function mousemoveCb(positions, source) {\n      return emit({\n        data: {\n          positions: positions,\n          source: source\n        },\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    mutationCb: function mutationCb(m) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.Mutation\n        }, m),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    scrollCb: function scrollCb(p) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.Scroll\n        }, p),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    styleSheetRuleCb: function styleSheetRuleCb(r) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.StyleSheetRule\n        }, r),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    viewportResizeCb: function viewportResizeCb(d) {\n      return emit({\n        data: __assign({\n          source: IncrementalSource.ViewportResize\n        }, d),\n        type: RecordType.IncrementalSnapshot\n      });\n    },\n    focusCb: function focusCb(data) {\n      return emit({\n        type: RecordType.Focus,\n        data: data\n      });\n    }\n  });\n  return {\n    stop: stopObservers,\n    takeFullSnapshot: takeFullSnapshot,\n    flushMutations: function flushMutations() {\n      return mutationController.flush();\n    }\n  };\n}","map":{"version":3,"mappings":"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","names":["RecordType","serializeDocument","initObservers","IncrementalSource","getWindowHeight","getWindowWidth","MutationController","record","options","emit","Error","mutationController","takeFullSnapshot","flush","data","height","href","window","location","width","type","Meta","has_focus","document","hasFocus","Focus","node","initialPrivacyLevel","initialOffset","left","pageXOffset","undefined","documentElement","scrollLeft","body","_a","parentElement","_b","top","pageYOffset","scrollTop","_c","_d","FullSnapshot","stopObservers","inputCb","v","source","Input","IncrementalSnapshot","mediaInteractionCb","p","MediaInteraction","mouseInteractionCb","d","MouseInteraction","mousemoveCb","positions","mutationCb","m","Mutation","scrollCb","Scroll","styleSheetRuleCb","r","StyleSheetRule","viewportResizeCb","ViewportResize","focusCb","stop","flushMutations"],"sourceRoot":"","sources":["../../../src/domain/record/record.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}