{"ast":null,"code":"import { isNumber, round } from './utils';\nexport function relativeToClocks(relative) {\n  return {\n    relative: relative,\n    timeStamp: getCorrectedTimeStamp(relative)\n  };\n}\n\nfunction getCorrectedTimeStamp(relativeTime) {\n  var correctedOrigin = Date.now() - performance.now(); // apply correction only for positive drift\n\n  if (correctedOrigin > getNavigationStart()) {\n    // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n    return Math.round(correctedOrigin + relativeTime);\n  }\n\n  return getTimeStamp(relativeTime);\n}\n\nexport function currentDrift() {\n  // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n  return Math.round(Date.now() - (getNavigationStart() + performance.now()));\n}\nexport function toServerDuration(duration) {\n  if (!isNumber(duration)) {\n    return duration;\n  }\n\n  return round(duration * 1e6, 0);\n}\nexport function timeStampNow() {\n  return Date.now();\n}\nexport function relativeNow() {\n  return performance.now();\n}\nexport function clocksNow() {\n  return {\n    relative: relativeNow(),\n    timeStamp: timeStampNow()\n  };\n}\nexport function clocksOrigin() {\n  return {\n    relative: 0,\n    timeStamp: getNavigationStart()\n  };\n}\nexport function elapsed(start, end) {\n  return end - start;\n}\n/**\n * Get the time since the navigation was started.\n *\n * Note: this does not use `performance.timeOrigin` because it doesn't seem to reflect the actual\n * time on which the navigation has started: it may be much farther in the past, at least in Firefox 71.\n * Related issue in Firefox: https://bugzilla.mozilla.org/show_bug.cgi?id=1429926\n */\n\nexport function getRelativeTime(timestamp) {\n  return timestamp - getNavigationStart();\n}\nexport function getTimeStamp(relativeTime) {\n  // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n  return Math.round(getNavigationStart() + relativeTime);\n}\n/**\n * Navigation start slightly change on some rare cases\n */\n\nvar navigationStart;\n\nfunction getNavigationStart() {\n  if (navigationStart === undefined) {\n    navigationStart = performance.timing.navigationStart;\n  }\n\n  return navigationStart;\n}\n\nexport function resetNavigationStart() {\n  navigationStart = undefined;\n}","map":{"version":3,"mappings":"AAAA,SAASA,QAAT,EAAmBC,KAAnB,QAAgC,SAAhC;AAQA,OAAM,SAAUC,gBAAV,CAA2BC,QAA3B,EAAiD;EACrD,OAAO;IAAEA,QAAQ,UAAV;IAAYC,SAAS,EAAEC,qBAAqB,CAACF,QAAD;EAA5C,CAAP;AACD;;AAED,SAASE,qBAAT,CAA+BC,YAA/B,EAAyD;EACvD,IAAMC,eAAe,GAAGC,IAAI,CAACC,GAAL,KAAaC,WAAW,CAACD,GAAZ,EAArC,CADuD,CAEvD;;EACA,IAAIF,eAAe,GAAGI,kBAAkB,EAAxC,EAA4C;IAC1C;IACA,OAAOC,IAAI,CAACX,KAAL,CAAWM,eAAe,GAAGD,YAA7B,CAAP;EACD;;EACD,OAAOO,YAAY,CAACP,YAAD,CAAnB;AACD;;AAED,OAAM,SAAUQ,YAAV,GAAsB;EAC1B;EACA,OAAOF,IAAI,CAACX,KAAL,CAAWO,IAAI,CAACC,GAAL,MAAcE,kBAAkB,KAAKD,WAAW,CAACD,GAAZ,EAArC,CAAX,CAAP;AACD;AAID,OAAM,SAAUM,gBAAV,CAA2BC,QAA3B,EAAyD;EAC7D,IAAI,CAAChB,QAAQ,CAACgB,QAAD,CAAb,EAAyB;IACvB,OAAOA,QAAP;EACD;;EACD,OAAOf,KAAK,CAACe,QAAQ,GAAG,GAAZ,EAAiB,CAAjB,CAAZ;AACD;AAED,OAAM,SAAUC,YAAV,GAAsB;EAC1B,OAAOT,IAAI,CAACC,GAAL,EAAP;AACD;AAED,OAAM,SAAUS,WAAV,GAAqB;EACzB,OAAOR,WAAW,CAACD,GAAZ,EAAP;AACD;AAED,OAAM,SAAUU,SAAV,GAAmB;EACvB,OAAO;IAAEhB,QAAQ,EAAEe,WAAW,EAAvB;IAA2Bd,SAAS,EAAEa,YAAY;EAAlD,CAAP;AACD;AAED,OAAM,SAAUG,YAAV,GAAsB;EAC1B,OAAO;IAAEjB,QAAQ,EAAE,CAAZ;IAA+BC,SAAS,EAAEO,kBAAkB;EAA5D,CAAP;AACD;AAID,OAAM,SAAUU,OAAV,CAAkBC,KAAlB,EAAiCC,GAAjC,EAA4C;EAChD,OAAQA,GAAG,GAAGD,KAAd;AACD;AAED;;;;;;;;AAOA,OAAM,SAAUE,eAAV,CAA0BC,SAA1B,EAA8C;EAClD,OAAQA,SAAS,GAAGd,kBAAkB,EAAtC;AACD;AAED,OAAM,SAAUE,YAAV,CAAuBP,YAAvB,EAAiD;EACrD;EACA,OAAOM,IAAI,CAACX,KAAL,CAAWU,kBAAkB,KAAKL,YAAlC,CAAP;AACD;AAED;;;;AAGA,IAAIoB,eAAJ;;AAEA,SAASf,kBAAT,GAA2B;EACzB,IAAIe,eAAe,KAAKC,SAAxB,EAAmC;IACjCD,eAAe,GAAGhB,WAAW,CAACkB,MAAZ,CAAmBF,eAArC;EACD;;EACD,OAAOA,eAAP;AACD;;AAED,OAAM,SAAUG,oBAAV,GAA8B;EAClCH,eAAe,GAAGC,SAAlB;AACD","names":["isNumber","round","relativeToClocks","relative","timeStamp","getCorrectedTimeStamp","relativeTime","correctedOrigin","Date","now","performance","getNavigationStart","Math","getTimeStamp","currentDrift","toServerDuration","duration","timeStampNow","relativeNow","clocksNow","clocksOrigin","elapsed","start","end","getRelativeTime","timestamp","navigationStart","undefined","timing","resetNavigationStart"],"sourceRoot":"","sources":["../../src/tools/timeUtils.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}