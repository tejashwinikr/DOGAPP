{"ast":null,"code":"import { ErrorSource } from './error';\nimport { clocksNow } from './timeUtils';\nimport { ONE_MINUTE } from './utils';\nexport function createErrorFilter(configuration, onLimitReached) {\n  var errorCount = 0;\n  var allowNextError = false;\n  return {\n    isLimitReached: function isLimitReached() {\n      if (errorCount === 0) {\n        setTimeout(function () {\n          errorCount = 0;\n        }, ONE_MINUTE);\n      }\n\n      errorCount += 1;\n\n      if (errorCount <= configuration.maxErrorsByMinute || allowNextError) {\n        allowNextError = false;\n        return false;\n      }\n\n      if (errorCount === configuration.maxErrorsByMinute + 1) {\n        allowNextError = true;\n\n        try {\n          onLimitReached({\n            message: \"Reached max number of errors by minute: \" + configuration.maxErrorsByMinute,\n            source: ErrorSource.AGENT,\n            startClocks: clocksNow()\n          });\n        } finally {\n          allowNextError = false;\n        }\n      }\n\n      return true;\n    }\n  };\n}","map":{"version":3,"mappings":"AACA,SAASA,WAAT,QAAsC,SAAtC;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,UAAT,QAA2B,SAA3B;AAIA,OAAM,SAAUC,iBAAV,CAA4BC,aAA5B,EAA0DC,cAA1D,EAAwG;EAC5G,IAAIC,UAAU,GAAG,CAAjB;EACA,IAAIC,cAAc,GAAG,KAArB;EAEA,OAAO;IACLC,cAAc;MACZ,IAAIF,UAAU,KAAK,CAAnB,EAAsB;QACpBG,UAAU,CAAC;UACTH,UAAU,GAAG,CAAb;QACD,CAFS,EAEPJ,UAFO,CAAV;MAGD;;MAEDI,UAAU,IAAI,CAAd;;MACA,IAAIA,UAAU,IAAIF,aAAa,CAACM,iBAA5B,IAAiDH,cAArD,EAAqE;QACnEA,cAAc,GAAG,KAAjB;QACA,OAAO,KAAP;MACD;;MAED,IAAID,UAAU,KAAKF,aAAa,CAACM,iBAAd,GAAkC,CAArD,EAAwD;QACtDH,cAAc,GAAG,IAAjB;;QACA,IAAI;UACFF,cAAc,CAAC;YACbM,OAAO,EAAE,6CAA2CP,aAAa,CAACM,iBADrD;YAEbE,MAAM,EAAEZ,WAAW,CAACa,KAFP;YAGbC,WAAW,EAAEb,SAAS;UAHT,CAAD,CAAd;QAKD,CAND,SAMU;UACRM,cAAc,GAAG,KAAjB;QACD;MACF;;MAED,OAAO,IAAP;IACD;EA5BI,CAAP;AA8BD","names":["ErrorSource","clocksNow","ONE_MINUTE","createErrorFilter","configuration","onLimitReached","errorCount","allowNextError","isLimitReached","setTimeout","maxErrorsByMinute","message","source","AGENT","startClocks"],"sourceRoot":"","sources":["../../src/tools/errorFilter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}