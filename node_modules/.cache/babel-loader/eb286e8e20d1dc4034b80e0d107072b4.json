{"ast":null,"code":"import { isEmptyObject, mapValues, toServerDuration } from '@datadog/browser-core';\nimport { RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackViews } from './trackViews';\nexport function startViewCollection(lifeCycle, configuration, location, domMutationObservable, foregroundContexts, recorderApi, initialViewName) {\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n    return lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processViewUpdate(view, foregroundContexts, recorderApi));\n  });\n  return trackViews(location, lifeCycle, domMutationObservable, !configuration.trackViewsManually, configuration, initialViewName);\n}\n\nfunction processViewUpdate(view, foregroundContexts, recorderApi) {\n  var replayStats = recorderApi.getReplayStats(view.id);\n  var viewEvent = {\n    _dd: {\n      document_version: view.documentVersion,\n      replay_stats: replayStats\n    },\n    date: view.startClocks.timeStamp,\n    type: RumEventType.VIEW,\n    view: {\n      action: {\n        count: view.eventCounts.userActionCount\n      },\n      cumulative_layout_shift: view.cumulativeLayoutShift,\n      dom_complete: toServerDuration(view.timings.domComplete),\n      dom_content_loaded: toServerDuration(view.timings.domContentLoaded),\n      dom_interactive: toServerDuration(view.timings.domInteractive),\n      error: {\n        count: view.eventCounts.errorCount\n      },\n      first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),\n      first_input_delay: toServerDuration(view.timings.firstInputDelay),\n      first_input_time: toServerDuration(view.timings.firstInputTime),\n      is_active: view.isActive,\n      name: view.name,\n      largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),\n      load_event: toServerDuration(view.timings.loadEvent),\n      loading_time: toServerDuration(view.loadingTime),\n      loading_type: view.loadingType,\n      long_task: {\n        count: view.eventCounts.longTaskCount\n      },\n      resource: {\n        count: view.eventCounts.resourceCount\n      },\n      time_spent: toServerDuration(view.duration),\n      in_foreground_periods: foregroundContexts.getInForegroundPeriods(view.startClocks.relative, view.duration)\n    },\n    session: {\n      has_replay: replayStats ? true : undefined\n    }\n  };\n\n  if (!isEmptyObject(view.customTimings)) {\n    viewEvent.view.custom_timings = mapValues(view.customTimings, toServerDuration);\n  }\n\n  return {\n    rawRumEvent: viewEvent,\n    startTime: view.startClocks.relative,\n    domainContext: {\n      location: view.location\n    }\n  };\n}","map":{"version":3,"mappings":"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","names":["isEmptyObject","mapValues","toServerDuration","RumEventType","LifeCycleEventType","trackViews","startViewCollection","lifeCycle","configuration","location","domMutationObservable","foregroundContexts","recorderApi","initialViewName","subscribe","VIEW_UPDATED","view","notify","RAW_RUM_EVENT_COLLECTED","processViewUpdate","trackViewsManually","replayStats","getReplayStats","id","viewEvent","_dd","document_version","documentVersion","replay_stats","date","startClocks","timeStamp","type","VIEW","action","count","eventCounts","userActionCount","cumulative_layout_shift","cumulativeLayoutShift","dom_complete","timings","domComplete","dom_content_loaded","domContentLoaded","dom_interactive","domInteractive","error","errorCount","first_contentful_paint","firstContentfulPaint","first_input_delay","firstInputDelay","first_input_time","firstInputTime","is_active","isActive","name","largest_contentful_paint","largestContentfulPaint","load_event","loadEvent","loading_time","loadingTime","loading_type","loadingType","long_task","longTaskCount","resource","resourceCount","time_spent","duration","in_foreground_periods","getInForegroundPeriods","relative","session","has_replay","undefined","customTimings","custom_timings","rawRumEvent","startTime","domainContext"],"sourceRoot":"","sources":["../../../../src/domain/rumEventsCollection/view/viewCollection.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}