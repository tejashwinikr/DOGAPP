{"ast":null,"code":"import { display } from '../tools/display';\nimport { findCommaSeparatedValue, generateUUID, ONE_SECOND } from '../tools/utils';\nexport var COOKIE_ACCESS_DELAY = ONE_SECOND;\nexport function cacheCookieAccess(name, options) {\n  var timeout;\n  var cache;\n  var hasCache = false;\n\n  var cacheAccess = function cacheAccess() {\n    hasCache = true;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      hasCache = false;\n    }, COOKIE_ACCESS_DELAY);\n  };\n\n  return {\n    get: function get() {\n      if (hasCache) {\n        return cache;\n      }\n\n      cache = getCookie(name);\n      cacheAccess();\n      return cache;\n    },\n    set: function set(value, expireDelay) {\n      setCookie(name, value, expireDelay, options);\n      cache = value;\n      cacheAccess();\n    }\n  };\n}\nexport function setCookie(name, value, expireDelay, options) {\n  var date = new Date();\n  date.setTime(date.getTime() + expireDelay);\n  var expires = \"expires=\" + date.toUTCString();\n  var sameSite = options && options.crossSite ? 'none' : 'strict';\n  var domain = options && options.domain ? \";domain=\" + options.domain : '';\n  var secure = options && options.secure ? \";secure\" : '';\n  document.cookie = name + \"=\" + value + \";\" + expires + \";path=/;samesite=\" + sameSite + domain + secure;\n}\nexport function getCookie(name) {\n  return findCommaSeparatedValue(document.cookie, name);\n}\nexport function deleteCookie(name, options) {\n  setCookie(name, '', 0, options);\n}\nexport function areCookiesAuthorized(options) {\n  if (document.cookie === undefined || document.cookie === null) {\n    return false;\n  }\n\n  try {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = \"dd_cookie_test_\" + generateUUID();\n    var testCookieValue = 'test';\n    setCookie(testCookieName, testCookieValue, ONE_SECOND, options);\n    var isCookieCorrectlySet = getCookie(testCookieName) === testCookieValue;\n    deleteCookie(testCookieName, options);\n    return isCookieCorrectlySet;\n  } catch (error) {\n    display.error(error);\n    return false;\n  }\n}\n/**\n * No API to retrieve it, number of levels for subdomain and suffix are unknown\n * strategy: find the minimal domain on which cookies are allowed to be set\n * https://web.dev/same-site-same-origin/#site\n */\n\nvar getCurrentSiteCache;\nexport function getCurrentSite() {\n  if (getCurrentSiteCache === undefined) {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = \"dd_site_test_\" + generateUUID();\n    var testCookieValue = 'test';\n    var domainLevels = window.location.hostname.split('.');\n    var candidateDomain = domainLevels.pop();\n\n    while (domainLevels.length && !getCookie(testCookieName)) {\n      candidateDomain = domainLevels.pop() + \".\" + candidateDomain;\n      setCookie(testCookieName, testCookieValue, ONE_SECOND, {\n        domain: candidateDomain\n      });\n    }\n\n    deleteCookie(testCookieName, {\n      domain: candidateDomain\n    });\n    getCurrentSiteCache = candidateDomain;\n  }\n\n  return getCurrentSiteCache;\n}","map":{"version":3,"mappings":"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","names":["display","findCommaSeparatedValue","generateUUID","ONE_SECOND","COOKIE_ACCESS_DELAY","cacheCookieAccess","name","options","timeout","cache","hasCache","cacheAccess","clearTimeout","setTimeout","get","getCookie","set","value","expireDelay","setCookie","date","Date","setTime","getTime","expires","toUTCString","sameSite","crossSite","domain","secure","document","cookie","deleteCookie","areCookiesAuthorized","undefined","testCookieName","testCookieValue","isCookieCorrectlySet","error","getCurrentSiteCache","getCurrentSite","domainLevels","window","location","hostname","split","candidateDomain","pop","length"],"sourceRoot":"","sources":["../../src/browser/cookie.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}