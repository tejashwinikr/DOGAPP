{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { combine, toServerDuration, generateUUID } from '@datadog/browser-core';\nimport { ActionType, RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackActions } from './trackActions';\nexport function startActionCollection(lifeCycle, domMutationObservable, configuration, foregroundContexts) {\n  lifeCycle.subscribe(LifeCycleEventType.AUTO_ACTION_COMPLETED, function (action) {\n    return lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processAction(action, foregroundContexts));\n  });\n\n  if (configuration.trackInteractions) {\n    trackActions(lifeCycle, domMutationObservable, configuration);\n  }\n\n  return {\n    addAction: function addAction(action, savedCommonContext) {\n      lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, __assign({\n        savedCommonContext: savedCommonContext\n      }, processAction(action, foregroundContexts)));\n    }\n  };\n}\n\nfunction processAction(action, foregroundContexts) {\n  var autoActionProperties = isAutoAction(action) ? {\n    action: {\n      error: {\n        count: action.counts.errorCount\n      },\n      id: action.id,\n      loading_time: toServerDuration(action.duration),\n      long_task: {\n        count: action.counts.longTaskCount\n      },\n      resource: {\n        count: action.counts.resourceCount\n      }\n    }\n  } : undefined;\n  var customerContext = !isAutoAction(action) ? action.context : undefined;\n  var actionEvent = combine({\n    action: {\n      id: generateUUID(),\n      target: {\n        name: action.name\n      },\n      type: action.type\n    },\n    date: action.startClocks.timeStamp,\n    type: RumEventType.ACTION\n  }, autoActionProperties);\n  var inForeground = foregroundContexts.getInForeground(action.startClocks.relative);\n\n  if (inForeground !== undefined) {\n    actionEvent.view = {\n      in_foreground: inForeground\n    };\n  }\n\n  return {\n    customerContext: customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action) ? {\n      event: action.event\n    } : {}\n  };\n}\n\nfunction isAutoAction(action) {\n  return action.type !== ActionType.CUSTOM;\n}","map":{"version":3,"mappings":";AAAA,SAASA,OAAT,EAAiCC,gBAAjC,EAAmDC,YAAnD,QAAuE,uBAAvE;AACA,SAASC,UAAT,EAAoCC,YAApC,QAA2E,4BAA3E;AACA,SAAoBC,kBAApB,QAAwE,iBAAxE;AAGA,SAAmCC,YAAnC,QAAuD,gBAAvD;AAEA,OAAM,SAAUC,qBAAV,CACJC,SADI,EAEJC,qBAFI,EAGJC,aAHI,EAIJC,kBAJI,EAIkC;EAEtCH,SAAS,CAACI,SAAV,CAAoBP,kBAAkB,CAACQ,qBAAvC,EAA8D,UAACC,MAAD,EAAO;IACnE,gBAAS,CAACC,MAAV,CAAiBV,kBAAkB,CAACW,uBAApC,EAA6DC,aAAa,CAACH,MAAD,EAASH,kBAAT,CAA1E;EAAuG,CADzG;;EAIA,IAAID,aAAa,CAACQ,iBAAlB,EAAqC;IACnCZ,YAAY,CAACE,SAAD,EAAYC,qBAAZ,EAAmCC,aAAnC,CAAZ;EACD;;EAED,OAAO;IACLS,SAAS,EAAE,mBAACL,MAAD,EAAuBM,kBAAvB,EAAyD;MAClEZ,SAAS,CAACO,MAAV,CAAiBV,kBAAkB,CAACW,uBAApC,EAA2DK;QACzDD,kBAAkB;MADuC,GAEtDH,aAAa,CAACH,MAAD,EAASH,kBAAT,CAFyC,CAA3D;IAID;EANI,CAAP;AAQD;;AAED,SAASM,aAAT,CACEH,MADF,EAEEH,kBAFF,EAEwC;EAEtC,IAAMW,oBAAoB,GAAGC,YAAY,CAACT,MAAD,CAAZ,GACzB;IACEA,MAAM,EAAE;MACNU,KAAK,EAAE;QACLC,KAAK,EAAEX,MAAM,CAACY,MAAP,CAAcC;MADhB,CADD;MAINC,EAAE,EAAEd,MAAM,CAACc,EAJL;MAKNC,YAAY,EAAE5B,gBAAgB,CAACa,MAAM,CAACgB,QAAR,CALxB;MAMNC,SAAS,EAAE;QACTN,KAAK,EAAEX,MAAM,CAACY,MAAP,CAAcM;MADZ,CANL;MASNC,QAAQ,EAAE;QACRR,KAAK,EAAEX,MAAM,CAACY,MAAP,CAAcQ;MADb;IATJ;EADV,CADyB,GAgBzBC,SAhBJ;EAiBA,IAAMC,eAAe,GAAG,CAACb,YAAY,CAACT,MAAD,CAAb,GAAwBA,MAAM,CAACuB,OAA/B,GAAyCF,SAAjE;EACA,IAAMG,WAAW,GAAsBtC,OAAO,CAC5C;IACEc,MAAM,EAAE;MACNc,EAAE,EAAE1B,YAAY,EADV;MAENqC,MAAM,EAAE;QACNC,IAAI,EAAE1B,MAAM,CAAC0B;MADP,CAFF;MAKNC,IAAI,EAAE3B,MAAM,CAAC2B;IALP,CADV;IAQEC,IAAI,EAAE5B,MAAM,CAAC6B,WAAP,CAAmBC,SAR3B;IASEH,IAAI,EAAErC,YAAY,CAACyC;EATrB,CAD4C,EAY5CvB,oBAZ4C,CAA9C;EAcA,IAAMwB,YAAY,GAAGnC,kBAAkB,CAACoC,eAAnB,CAAmCjC,MAAM,CAAC6B,WAAP,CAAmBK,QAAtD,CAArB;;EACA,IAAIF,YAAY,KAAKX,SAArB,EAAgC;IAC9BG,WAAW,CAACW,IAAZ,GAAmB;MAAEC,aAAa,EAAEJ;IAAjB,CAAnB;EACD;;EACD,OAAO;IACLV,eAAe,iBADV;IAELe,WAAW,EAAEb,WAFR;IAGLc,SAAS,EAAEtC,MAAM,CAAC6B,WAAP,CAAmBK,QAHzB;IAILK,aAAa,EAAE9B,YAAY,CAACT,MAAD,CAAZ,GAAuB;MAAEwC,KAAK,EAAExC,MAAM,CAACwC;IAAhB,CAAvB,GAAiD;EAJ3D,CAAP;AAMD;;AAED,SAAS/B,YAAT,CAAsBT,MAAtB,EAAuD;EACrD,OAAOA,MAAM,CAAC2B,IAAP,KAAgBtC,UAAU,CAACoD,MAAlC;AACD","names":["combine","toServerDuration","generateUUID","ActionType","RumEventType","LifeCycleEventType","trackActions","startActionCollection","lifeCycle","domMutationObservable","configuration","foregroundContexts","subscribe","AUTO_ACTION_COMPLETED","action","notify","RAW_RUM_EVENT_COLLECTED","processAction","trackInteractions","addAction","savedCommonContext","__assign","autoActionProperties","isAutoAction","error","count","counts","errorCount","id","loading_time","duration","long_task","longTaskCount","resource","resourceCount","undefined","customerContext","context","actionEvent","target","name","type","date","startClocks","timeStamp","ACTION","inForeground","getInForeground","relative","view","in_foreground","rawRumEvent","startTime","domainContext","event","CUSTOM"],"sourceRoot":"","sources":["../../../../src/domain/rumEventsCollection/action/actionCollection.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}